<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes de Ventas - Papelería Smarty</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='reportes_ventas.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='paginaPrincipal.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Botón para abrir/cerrar el menú -->
    <div class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Menú lateral -->
    <aside class="menu-lateral" id="menuLateral">
        <div class="menu-header">
            <h2>Menú</h2>
        </div>
        <ul class="menu-items">
            <li><a href="/index"><i class="fas fa-home"></i> Inicio</a></li>
            <li><a href="{{ url_for('ver_productos.mostrar_productos') }}"><i class="fas fa-eye"></i> Ver Productos</a></li>            
            <li>
                <a href="#" id="movimientos"><i class="fas fa-exchange-alt"></i> Movimientos</a>
                <ul class="submenu" id="submenuMovimientos">
                    <li><a href="/entrada_producto"><i class="fas fa-plus"></i> Entrada</a></li>
                    <li><a href="/salida_producto"><i class="fas fa-minus"></i> Salida</a></li>
                </ul>
            </li>
            <li><a href="/reportes_ventas"><i class="fas fa-chart-line"></i> Reportes de Ventas</a></li>
            <li><a href="/mi_cuenta"><i class="fas fa-users"></i> Mi Cuenta</a></li>
            <li>
                <a href="/logout"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
            </li>
        </ul>
    </aside>

    <!-- Contenido principal -->
    <main class="contenido-principal" id="contenidoPrincipal">
        <header>
            <div class="container">
                <h1>Papelería Smarty</h1>
          
            </div>
        </header>

        <div class="container-ventas">
            <!-- Encabezado -->
            <header class="reporte-ventas">
                <h1>Reportes de Ventas</h1>
                <p>Visualiza las ventas realizadas por mes.</p>
            </header>

            <div class="filtro-fechas">
                <label for="fecha-inicio">Fecha Inicio:</label>
                <input type="date" id="fecha-inicio" name="fecha-inicio">
            
                <label for="fecha-fin">Fecha Fin:</label>
                <input type="date" id="fecha-fin" name="fecha-fin">
            
                <button id="generar-reporte">
                    <i class="fas fa-chart-line"></i> Generar Reporte
                </button>
            
                <!-- Botón de descarga en PDF -->
                <button id="descargar-pdf" >
                    <i class="fas fa-file-pdf"></i> Descargar PDF
                </button>
            </div>

            <!-- Tabla de Reportes -->
            <div class="tabla-reportes">
                <table>
                    <thead>
                        <tr>
                            <th>ID Movimiento</th>
                            <th>Producto</th>
                            <th>Tipo</th>
                            <th>Cantidad</th>
                            <th>Fecha</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if movimientos %}
                            {% if movimientos|length > 0 %}
                                {% for movimiento in movimientos %}
                                <tr>
                                    <td>{{ movimiento.id_moviento }}</td>
                                    <td>{{ movimiento.nombre_producto }}</td>
                                    <td>{{ movimiento.tipo }}</td>
                                    <td>{{ movimiento.cantidad }}</td>
                                    <td>{{ movimiento.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                                    <td>${{ "%.2f"|format(movimiento.total_movimiento) }}</td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" style="text-align: center;">
                                        {% if request.args.get('fecha_inicio') %}
                                            No hay movimientos en este rango de fechas.
                                        {% else %}
                                            Seleccione un rango de fechas para generar el reporte.
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endif %}
                        {% else %}
                            <tr>
                                <td colspan="6" style="text-align: center;">
                                    Error al cargar los movimientos
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </main>

<!-- Modal de alerta de stock bajo -->
<div id="warningModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="modal-icon">
            <i class="fas fa-exclamation-circle"></i> <!-- Icono de advertencia -->
        </div>
        <h3>Por favor, seleccione ambas fechas</h3>
        <p id="warningMessage"></p>
        <button id="acceptWarningButton" class="cta-button">Aceptar</button>
    </div>
</div>

    <!-- Scripts -->
    <script>
        const menuToggle = document.getElementById('menuToggle');
        const menuLateral = document.getElementById('menuLateral');
        const contenidoPrincipal = document.getElementById('contenidoPrincipal');
        const movimientosLink = document.getElementById('movimientos');
        const submenuMovimientos = document.getElementById('submenuMovimientos');

        // Alternar el menú lateral
        menuToggle.addEventListener('click', () => {
            menuLateral.classList.toggle('active');
            contenidoPrincipal.classList.toggle('menu-active');
        });

        // Alternar el submenú de Movimientos
        movimientosLink.addEventListener('click', (e) => {
            e.preventDefault(); // Evitar que el enlace redirija
            submenuMovimientos.classList.toggle('active');
        });

// Generar reporte al hacer clic en el botón
document.getElementById('generar-reporte').addEventListener('click', () => {
    const fechaInicio = document.getElementById('fecha-inicio').value;
    const fechaFin = document.getElementById('fecha-fin').value;

    if (!fechaInicio || !fechaFin) {
        // Mostrar modal de advertencia
        const warningModal = document.getElementById('warningModal');
        const warningMessage = document.getElementById('warningMessage');
        warningMessage.textContent = 'Por favor, selecciona ambas fechas.';
        warningModal.style.display = 'flex';
        return;
    }

    // Redirigir con parámetros GET
    window.location.href = `/reportes_ventas?fecha_inicio=${fechaInicio}&fecha_fin=${fechaFin}`;
});

// Cerrar el modal de advertencia al hacer clic en el botón de aceptar
document.getElementById('acceptWarningButton').addEventListener('click', () => {
    const warningModal = document.getElementById('warningModal');
    warningModal.style.display = 'none';
});

// Cerrar el modal de advertencia al hacer clic en la "X"
document.querySelector('.close').addEventListener('click', () => {
    const warningModal = document.getElementById('warningModal');
    warningModal.style.display = 'none';
});

// Cerrar el modal de advertencia al hacer clic fuera del modal
window.addEventListener('click', (event) => {
    const warningModal = document.getElementById('warningModal');
    if (event.target === warningModal) {
        warningModal.style.display = 'none';
    }
});

// Descargar PDF al hacer clic en el botón
document.getElementById('descargar-pdf').addEventListener('click', () => {
    const fechaInicio = document.getElementById('fecha-inicio').value;
    const fechaFin = document.getElementById('fecha-fin').value;

    if (!fechaInicio || !fechaFin) {
        const warningModal = document.getElementById('warningModal');
        const warningMessage = document.getElementById('warningMessage');
        warningMessage.textContent = 'Por favor, selecciona ambas fechas para generar el PDF.';
        warningModal.style.display = 'flex';
        return;
    }

    // Redirigir con parámetro download=pdf
    window.location.href = `/reportes_ventas?fecha_inicio=${fechaInicio}&fecha_fin=${fechaFin}&download=pdf`;
});

    </script>
</body>
</html>